# Overview

	The system we’re using is a third party django library, called Django Gmail Api Backend.  It can be found here [https://pypi.org/project/django-gmailapi-backend/](https://pypi.org/project/django-gmailapi-backend/) and installed via pip.  The core functionality of this is just what it sounds like: it adds the gmail api as a possible email backend in Django.

	Access to gmail is regulated through three kinds of tokens: A session ID, a client secret, and a refresh token.  At present, these three items are hardcoded into the settings.py file as strings.  Updating them therefore simply involves replacing these strings with new, valid information.

# Setting the Backend

![][image1]  
	By default, the email background in the local environment is set to **console**.  This means that the email will be printed to the console, rather than sent to any actual address.  This is preferable for a development environment where we don’t have or need actual API keys, but is not representative of the production version.

	In order to test the Gmail API backend, make sure that the package is installed in your environment.  It must then be added as a third-party app in the Django config, and then finally set as the email backend. By configuring the three variables mentioned earlier, the program will begin to send emails through the authenticated account associated with those tokens automatically.

# Getting New Tokens

	The Gmail Backend package comes with a “helper script” that claims to be able to generate the relevant authentication tokens.  Unfortunately, this helper script uses Out of Band authentication: a deprecated method that, as of earlier this year, is completely disabled by Google.  Instead, we’re going to have to generate it ourselves.

	The Gmail API Python Quickstart contains code for querying an account to grab the labels associated with that mailbox.  To do this, it requires project credentials to identify itself to the Google servers.  These can be generated through the Google Developer Cloud API Console- Make sure they have the correct scope.

	Once you’ve acquired credentials.json from the API console, put that in the working directory of the example script.  Now, it should be able to grab the labels (provided that was included in the scope you gave your project.)  Django needs to be able to send mail, so you’ll need to change the “scopes” variable in the example script to point to [`https://www.googleapis.com/auth/gmail.send`](https://www.googleapis.com/auth/gmail.send)

	Note that the label grabbing will now fail, since the program is only asking for the ability to send messages.  This doesn’t stop it from generating the tokens we need, so go ahead and run the program.  If everything worked correctly, a browser will automatically launch and prompt you to sign into a google account.  Upon completion, the tokens will be distributed to the program and stored into tokens.json, located in the working directory of the program.

	Within tokens.json there are the three elements; the session ID, the client secret, and the refresh token that are necessary for the Django Backend to function.  These can just be copied and pasted into the settings.py file, and the program will now be able to send emails.  Emails will always originate from the email you signed into on your local computer, no matter what the “default sender” variable is in Django’s configuration.

[image1]: <data:image/png;base64,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>